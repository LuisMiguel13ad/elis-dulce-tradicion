---
phase: 03-dashboard-verification
plan: 03
type: execute
wave: 3
depends_on: ["03-01", "03-02"]
files_modified:
  - .planning/phases/03-dashboard-verification/03-VERIFICATION.md
autonomous: false

must_haves:
  truths:
    - "Owner Dashboard displays accurate revenue, orders, and average ticket metrics"
    - "Owner Dashboard charts render with real data"
    - "Front Desk order queue displays and filters orders correctly"
    - "Real-time order updates work on both dashboards"
    - "Reference images upload successfully and display in order details"
    - "Email notifications send when order status changes to ready"
    - "No console errors on either dashboard"
  artifacts:
    - path: ".planning/phases/03-dashboard-verification/03-VERIFICATION.md"
      provides: "Complete verification results for Phase 3"
      min_lines: 50
  key_links:
    - from: "Order form reference image upload"
      to: "Supabase Storage reference-images bucket"
      via: "uploadReferenceImage() in src/lib/storage.ts"
      pattern: "uploadReferenceImage"
    - from: "Status change to ready (Front Desk)"
      to: "send-ready-notification Edge Function"
      via: "api.sendReadyNotification() in src/lib/api.ts"
      pattern: "sendReadyNotification"
---

<objective>
Verify that both dashboards, reference image handling, and email notifications work correctly end-to-end.

Purpose: Ensure all Phase 3 requirements (DASH-01 through DASH-05) plus email and image functionality are production-ready.
Output: Verified dashboards with working images and emails, ready for production.
</objective>

<execution_context>
@/Users/luismiguel/.claude/get-shit-done/workflows/execute-plan.md
@/Users/luismiguel/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-dashboard-verification/CONTEXT.md
@.planning/phases/03-dashboard-verification/03-RESEARCH.md
@.planning/phases/03-dashboard-verification/03-01-SUMMARY.md
@.planning/phases/03-dashboard-verification/03-02-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 1: Test Reference Image Upload and Display</name>
  <action-required>
Test the reference image upload flow end-to-end:

**Step 1: Place a test order WITH a reference image**
1. Navigate to the order form: http://localhost:5173/order (or production URL)
2. Fill out basic order details (name, email, phone, date, cake size, filling)
3. **Upload a reference image** - use any JPG/PNG image under 5MB
4. Observe: Does the preview show? Does upload complete (toast success)?
5. Complete the order with payment

**Step 2: Verify image displays in dashboards**
1. Go to Front Desk: /front-desk
2. Find the test order - check if avatar shows the reference image (small thumbnail)
3. Click "View Order" to open the PrintPreviewModal
4. Check the left panel - does it show the reference photo or "No Reference Photo"?

**Step 3: Check Owner Dashboard**
1. Go to Owner Dashboard: /owner-dashboard
2. Find the order in Recent Orders or Orders tab
3. Click to open details - verify image displays

**Record your findings:**
- Upload success: YES/NO
- Preview shows during upload: YES/NO
- Front Desk thumbnail shows image: YES/NO
- PrintPreviewModal shows full image: YES/NO
- Any error messages: [describe]
  </action-required>
  <resume-signal>
Share results in format:
"image-test: upload=[YES/NO], preview=[YES/NO], thumbnail=[YES/NO], modal=[YES/NO], errors=[none/description]"
  </resume-signal>
  <done>
Reference image upload and display verified across order form and both dashboards.
  </done>
</task>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 2: Test Email Notifications on Status Change</name>
  <action-required>
Test that emails send correctly when order status changes:

**Pre-requisites:**
- Have a test order with YOUR email address as customer_email
- Ensure Supabase Edge Functions are deployed
- Ensure RESEND_API_KEY is configured

**Step 1: Test "Mark Ready" email**
1. Go to Front Desk: /front-desk
2. Find a test order with status "pending" or "confirmed"
3. Click "Mark Ready" button
4. Observe:
   - Toast shows "Sending email..."
   - Then shows "Email sent" (green) OR "Email failed" (red)
5. Check your email inbox (wait up to 60 seconds)
6. Check spam folder if not in inbox

**Step 2: Test "Complete" email (for pickup orders)**
1. Find an order with status "ready" and delivery_option "pickup"
2. Click "Complete Pickup" button
3. Observe toast notifications
4. Check email inbox for completion notification

**Step 3: Test "Delivered" email (for delivery orders)**
1. Find an order with status "ready" and delivery_option "delivery"
2. Click "Dispatch Driver" button
3. Observe toast notifications
4. Check email inbox for delivery notification

**Record your findings:**

| Action | Toast Shows | Email Received | Delay | In Spam? |
|--------|-------------|----------------|-------|----------|
| Mark Ready | | | | |
| Complete Pickup | | | | |
| Dispatch Delivery | | | | |
  </action-required>
  <resume-signal>
Share results in format:
"email-test: ready=[PASS/FAIL], complete=[PASS/FAIL], delivery=[PASS/FAIL], issues=[none/description]"
  </resume-signal>
  <done>
Email notifications verified working for all status transitions.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Verify Owner Dashboard Functionality</name>
  <what-built>
    After cleanup and tab integration:
    - Dead code removed (BakerStation, unused layouts, dev components, test data utilities)
    - Products tab integrated with MenuManager
    - Inventory tab integrated with InventoryManager
    - All original dashboard functionality preserved
  </what-built>
  <how-to-verify>
    1. Start development server: `npm run dev`
    2. Navigate to /owner-dashboard (login as owner if required)

    **DASH-01: Analytics Display**
    3. Verify metric cards display:
       - "Revenue Today" shows dollar amount
       - "Orders Today" shows count with pending sub-count
       - "Avg Ticket" shows per-order average
    4. Verify charts render:
       - Line chart shows revenue trends (7D/30D toggle works)
       - Pie chart shows order status breakdown

    **DASH-05: Owner-Specific Features**
    5. Click through all sidebar tabs:
       - Overview: Shows metrics, charts, recent orders
       - Orders: Shows full order list with search
       - Calendar: Shows calendar view with orders
       - Products: Shows MenuManager (product table)
       - Inventory: Shows InventoryManager (ingredient cards)
       - Reports: Shows report export buttons

    **DASH-04: Cleanup Verification**
    6. Open browser DevTools (F12) Console tab
    7. Check NO console errors appear
    8. Check "Generate Test Data" button is NOT present in header

    **Expected Results:**
    - All 6 sidebar tabs work and render content
    - Metrics show actual numbers (may be 0 if no orders)
    - Charts render (may be empty if no data)
    - No console errors
    - No test data button visible
  </how-to-verify>
  <resume-signal>
    Type "owner-dashboard-verified" if all checks pass.
    If issues found, describe them and type "issues-found: [description]"
  </resume-signal>
  <done>
Owner Dashboard verified: all 6 tabs working, analytics display correctly, no console errors.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 4: Verify Front Desk Dashboard and Real-time Updates</name>
  <what-built>
    Front Desk dashboard unchanged by cleanup (uses its own components).
    Real-time subscription via useRealtimeOrders hook.
  </what-built>
  <how-to-verify>
    **DASH-02: Order Queue Functionality**
    1. Navigate to /front-desk
    2. Verify order cards display with:
       - Customer name and order number
       - Order status badge (colored: black=New, yellow=Preparing, green=Ready)
       - Date/time due
       - Cake details (size, filling, theme)
       - Reference image thumbnail (if uploaded)
    3. Test status filter tabs: Active, New, Preparing, Pickup, Delivery, Done
    4. Click "View Order" on a card - should open PrintPreviewModal

    **DASH-03: Real-time Updates**
    5. Open BOTH dashboards in separate browser tabs:
       - Tab 1: /owner-dashboard
       - Tab 2: /front-desk
    6. On Front Desk, change an order status (e.g., Mark Ready)
    7. Verify Owner Dashboard updates within 5 seconds (toast notification, order list refresh)

    **Console Check**
    8. Check both tabs for console errors - should be none

    **Expected Results:**
    - Front Desk shows order cards with all details
    - Filter tabs work to show orders by status
    - Real-time updates propagate between dashboards
    - No console errors on either dashboard
  </how-to-verify>
  <resume-signal>
    Type "front-desk-verified" if all checks pass.
    If issues found, describe them and type "issues-found: [description]"
  </resume-signal>
  <done>
Front Desk verified: order queue works, filters function, real-time updates propagate.
  </done>
</task>

<task type="auto">
  <name>Task 5: Create Verification Document and Final Build Check</name>
  <files>
    .planning/phases/03-dashboard-verification/03-VERIFICATION.md
  </files>
  <action>
Based on all checkpoint results, create a comprehensive verification document.

1. Create `.planning/phases/03-dashboard-verification/03-VERIFICATION.md` with:
   - Summary of all test results
   - Reference image test results
   - Email notification test results
   - Dashboard verification results
   - Any issues found and their status (fixed/deferred)

2. Run final verification commands:
   ```bash
   npm run build
   npx tsc --noEmit
   ```

3. Document final pass/fail status for each DASH requirement:
   - DASH-01: Owner Dashboard analytics
   - DASH-02: Front Desk order queue
   - DASH-03: Real-time updates
   - DASH-04: Remove unused components
   - DASH-05: Owner analytics-focused interface
  </action>
  <verify>
    Run: `wc -l .planning/phases/03-dashboard-verification/03-VERIFICATION.md` - at least 50 lines
    Run: `npm run build` - exits with code 0
  </verify>
  <done>
Verification document created (50+ lines). Production build succeeds. All Phase 3 requirements documented with pass/fail status.
  </done>
</task>

</tasks>

<verification>
Phase 3 complete verification matrix:

| Requirement | Status | How Verified |
|-------------|--------|--------------|
| DASH-01: Owner analytics display | Via checkpoint | Metric cards + charts render |
| DASH-02: Front Desk order queue | Via checkpoint | Order cards + filters work |
| DASH-03: Real-time updates | Via checkpoint | Cross-tab updates propagate |
| DASH-04: Remove unused components | Via build | No deleted files referenced |
| DASH-05: Owner analytics-focused | Via checkpoint | 6 tabs including Products/Inventory |
| Reference images | Via checkpoint | Upload + display working |
| Email notifications | Via checkpoint | Status change triggers email |
</verification>

<success_criteria>
1. Reference image upload works and displays in dashboards
2. Email notifications send successfully on status changes
3. Owner Dashboard checkpoint passes - all 6 tabs work, metrics display, charts render
4. Front Desk checkpoint passes - order queue works, filters function
5. Real-time updates verified - changes propagate between dashboards
6. Production build succeeds with no errors
7. No console errors on either dashboard
8. Verification document created with all results
</success_criteria>

<output>
After completion, create `.planning/phases/03-dashboard-verification/03-03-SUMMARY.md`
</output>
