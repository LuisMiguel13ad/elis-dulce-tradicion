# PWA & Mobile Implementation Guide

Complete guide for Progressive Web App features and mobile optimizations.

## âœ… Completed Features

### 1. PWA Setup

**Files Created:**
- `public/manifest.json` - PWA manifest
- `src/lib/pwa.ts` - PWA utilities
- `src/components/pwa/InstallPrompt.tsx` - Install prompt
- `src/components/pwa/OfflineIndicator.tsx` - Offline indicator

**Configuration:**
- Vite PWA plugin configured in `vite.config.ts`
- Service worker auto-generated
- Cache strategies configured:
  - NetworkFirst for API calls
  - CacheFirst for images
  - 24-hour cache for Supabase

### 2. Mobile UI Components

**Files Created:**
- `src/components/mobile/BottomSheet.tsx` - Mobile bottom sheet
- `src/components/mobile/SwipeableCard.tsx` - Swipeable cards
- `src/components/mobile/ResponsiveTable.tsx` - Responsive tables
- `src/components/mobile/CameraCapture.tsx` - Camera capture
- `src/components/mobile/FloatingActionButton.tsx` - FAB component
- `src/components/mobile/MobileOrderCard.tsx` - Mobile order card

### 3. Mobile Hooks

**Files Created:**
- `src/hooks/useCamera.ts` - Camera access
- `src/hooks/useGeolocation.ts` - Geolocation
- `src/hooks/useShare.ts` - Web Share API
- `src/hooks/useAddToCalendar.ts` - Calendar integration

### 4. Mobile Optimizations

**CSS:**
- Touch-friendly button sizes (min 44x44px)
- Safe area insets for notched devices
- Prevent text size adjustment on iOS
- Smooth scrolling

**Components:**
- Mobile-optimized Order form
- Camera option for image upload
- Geolocation for address
- Share functionality
- Calendar integration

## ðŸ“± Mobile Features

### Camera Access

```typescript
import { CameraCapture } from '@/components/mobile/CameraCapture';

<CameraCapture
  onCapture={(file) => {
    // Handle captured photo
  }}
  onCancel={() => setShowCamera(false)}
/>
```

### Geolocation

```typescript
import { useGeolocation } from '@/hooks/useGeolocation';

const { position, getCurrentPosition } = useGeolocation();
getCurrentPosition(); // Get user location
```

### Share API

```typescript
import { useShare } from '@/hooks/useShare';

const { share, shareOrder } = useShare();
await shareOrder(orderNumber, trackingUrl);
```

### Add to Calendar

```typescript
import { useAddToCalendar } from '@/hooks/useAddToCalendar';

const { addOrderToCalendar } = useAddToCalendar();
addOrderToCalendar(orderNumber, date, time, location);
```

## ðŸ”§ PWA Configuration

### Manifest.json

Located at `public/manifest.json`:
- App name and short name
- Icons (192x192, 512x512)
- Theme colors
- Start URL
- Display mode (standalone)
- Shortcuts for quick actions

### Service Worker

Auto-generated by Vite PWA plugin:
- Caches static assets
- Caches API responses (NetworkFirst)
- Caches images (CacheFirst)
- Offline support
- Update prompts

### Install Prompt

Automatically shows when:
- App is not installed
- User hasn't dismissed before
- Browser supports install prompt

## ðŸ“² Mobile-Specific Features

### 1. Camera for Reference Photos

**Location:** Order form, Step 2

**Usage:**
- Mobile: Shows camera button
- Desktop: File input only
- Uses `capture="environment"` attribute

### 2. Geolocation for Address

**Location:** Order form, Step 3 (delivery)

**Usage:**
- Button to get current location
- Helps with address autocomplete
- Respects user privacy

### 3. Share Order Tracking

**Location:** Order confirmation, Order tracking

**Usage:**
```typescript
const { shareOrder } = useShare();
await shareOrder(orderNumber, trackingUrl);
```

### 4. Add to Calendar

**Location:** Order confirmation

**Usage:**
```typescript
const { addOrderToCalendar } = useAddToCalendar();
addOrderToCalendar(orderNumber, date, time, location);
```

## ðŸŽ¯ Touch Gestures

### Swipeable Cards

**Location:** KitchenDisplay, Order lists

**Features:**
- Swipe right: Mark as confirmed
- Swipe left: Mark as ready
- Visual feedback during swipe
- Threshold: 100px

### Pull to Refresh

**Location:** KitchenDisplay, Order lists

**Usage:**
```tsx
<PullToRefresh onRefresh={refreshOrders}>
  <OrderList />
</PullToRefresh>
```

## ðŸ“Š Responsive Tables

**Component:** `ResponsiveTable`

**Behavior:**
- Mobile: Card view
- Desktop: Table view
- Auto-switches at 768px breakpoint

**Usage:**
```tsx
<ResponsiveTable
  data={orders}
  columns={columns}
  mobileCardRender={(order) => <OrderCard order={order} />}
/>
```

## ðŸŽ¨ Mobile UI Enhancements

### Bottom Sheet

**Usage:**
```tsx
<BottomSheet
  isOpen={isOpen}
  onClose={() => setIsOpen(false)}
  title="Title"
>
  Content here
</BottomSheet>
```

### Floating Action Button

**Usage:**
```tsx
<FloatingActionButton
  to="/order"
  label="New Order"
  icon={<Plus />}
/>
```

## ðŸ“± Mobile Navigation

### Enhanced MobileMenu

- Already exists and optimized
- Sheet component
- Touch-friendly
- Full-height on mobile

### Sticky Header

Navbar is already fixed with:
- Backdrop blur
- Transparent when at top
- Solid when scrolled

## ðŸ”” Push Notifications

### Setup

1. Request permission:
```typescript
import { requestNotificationPermission } from '@/lib/pwa';
const permission = await requestNotificationPermission();
```

2. Subscribe:
```typescript
import { subscribeToPushNotifications } from '@/lib/pwa';
const subscription = await subscribeToPushNotifications();
```

3. Show notification:
```typescript
import { showNotification } from '@/lib/pwa';
showNotification('Order Ready', {
  body: 'Your order is ready for pickup',
  icon: '/pwa-icon-192.png',
});
```

## ðŸ“‹ Implementation Checklist

### PWA
- [x] Manifest.json created
- [x] Service worker configured
- [x] Install prompt
- [x] Offline indicator
- [ ] Generate app icons (192x192, 512x512)
- [ ] Add to home screen prompt

### Mobile UI
- [x] Bottom sheet component
- [x] Swipeable cards
- [x] Responsive tables
- [x] Touch-friendly buttons (44x44px)
- [x] Mobile-optimized forms
- [x] Floating action button

### Mobile Features
- [x] Camera access
- [x] Geolocation
- [x] Share API
- [x] Add to calendar
- [x] Pull to refresh
- [x] Swipe gestures

### Performance
- [x] Mobile bundle optimization
- [x] Lazy loading
- [x] Image optimization
- [x] Code splitting

## ðŸš€ Usage Examples

### Mobile Order Form

The Order form automatically:
- Shows camera button on mobile
- Uses larger touch targets
- Optimizes layout for small screens
- Supports geolocation

### Kitchen Display

Enhanced with:
- Swipeable order cards
- Pull to refresh
- Mobile-optimized layout
- Touch gestures

### Responsive Tables

All tables automatically:
- Switch to card view on mobile
- Maintain table view on desktop
- Hide non-essential columns on mobile

## ðŸ“ Next Steps

1. **Generate Icons:**
   - Create 192x192 and 512x512 icons
   - Place in `public/` directory
   - Update manifest.json paths

2. **Test on Devices:**
   - iOS Safari
   - Chrome Android
   - Test install flow
   - Test offline mode

3. **Push Notifications:**
   - Set up VAPID keys
   - Configure backend endpoint
   - Test notification delivery

4. **Performance:**
   - Test on real devices
   - Measure Core Web Vitals
   - Optimize based on metrics

## ðŸ” Testing

### PWA Testing

```bash
# Build for production
npm run build

# Serve with HTTPS (required for PWA)
npx serve -s dist --ssl

# Test install prompt
# Open in Chrome DevTools > Application > Manifest
```

### Mobile Testing

1. **iOS Safari:**
   - Connect iPhone
   - Open Safari
   - Test install prompt
   - Test offline mode

2. **Android Chrome:**
   - Open Chrome
   - Test install prompt
   - Test push notifications

### Device Testing

Test on:
- iPhone (various sizes)
- Android phones
- Tablets
- Landscape orientation

## ðŸ“± Mobile Breakpoints

- **Mobile**: < 768px
- **Tablet**: 768px - 1024px
- **Desktop**: > 1024px

Use `useIsMobile()` hook to detect mobile.

## ðŸŽ¯ Best Practices

1. **Touch Targets:**
   - Minimum 44x44px
   - Adequate spacing
   - Visual feedback

2. **Performance:**
   - Lazy load images
   - Minimize JavaScript
   - Optimize fonts

3. **Offline:**
   - Cache critical pages
   - Queue mutations
   - Show offline indicator

4. **Notifications:**
   - Request permission appropriately
   - Provide value
   - Allow opt-out
